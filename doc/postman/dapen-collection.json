{
	"info": {
		"_postman_id": "dapen-collection",
		"name": "Dapen Collection",
		"description": "Complete API collection for Dapen IAM Service.\n\n## Health Endpoints\n- GET /health - Basic health check\n- GET /health/ready - Readiness check\n- GET /health/live - Liveness check\n\n## Registration Flow Overview\n```\nCREATED → PENDING_VERIFICATION → VERIFIED → COMPLETED\n```\n\n## Registration Endpoints\n1. POST /registrations - Initiate registration\n2. POST /registrations/{id}/verify-otp - Verify OTP\n3. POST /registrations/{id}/resend-otp - Resend OTP\n4. POST /registrations/{id}/complete - Complete registration\n5. GET /registrations/{id}/status - Check status\n\n## Test Execution Order\nRun the \"Happy Path\" folder requests in sequence to test the complete registration flow.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Health",
			"item": [
				{
					"name": "Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function() {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has status field', function() {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.status).to.eql('healthy');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/health",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "health"]
						},
						"description": "Basic health check endpoint. Returns service health status.\n\n**Expected:** 200 OK with healthy status."
					},
					"response": [
						{
							"name": "200 - Healthy",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/health",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "health"]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"body": "{\n    \"status\": \"healthy\",\n    \"timestamp\": \"2026-02-05T10:30:00Z\"\n}"
						}
					]
				},
				{
					"name": "Ready Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function() {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Service is ready', function() {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.ready).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/health/ready",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "health", "ready"]
						},
						"description": "Readiness check for Kubernetes/container orchestration. Indicates if the service is ready to accept traffic.\n\n**Expected:** 200 OK when dependencies (DB, Redis) are connected."
					},
					"response": [
						{
							"name": "200 - Ready",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/health/ready",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "health", "ready"]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"body": "{\n    \"ready\": true\n}"
						},
						{
							"name": "503 - Not Ready",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/health/ready",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "health", "ready"]
								}
							},
							"status": "Service Unavailable",
							"code": 503,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"body": "{\n    \"ready\": false,\n    \"error\": \"database connection failed\"\n}"
						}
					]
				},
				{
					"name": "Live Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function() {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Service is alive', function() {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.alive).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/health/live",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "health", "live"]
						},
						"description": "Liveness check for Kubernetes/container orchestration. Indicates if the service process is running.\n\n**Expected:** 200 OK if service is alive (used for restart decisions)."
					},
					"response": [
						{
							"name": "200 - Alive",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/health/live",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "health", "live"]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"body": "{\n    \"alive\": true\n}"
						}
					]
				}
			],
			"description": "## Health Check Endpoints\n\nEndpoints for monitoring service health and orchestration.\n\n### Endpoints\n- **GET /health** - Basic health check\n- **GET /health/ready** - Readiness probe (Kubernetes)\n- **GET /health/live** - Liveness probe (Kubernetes)\n\n### Usage\n- **Health**: General service status\n- **Ready**: Check before routing traffic (DB, Redis connected)\n- **Live**: Check if process should be restarted"
		},
		{
			"name": "1. Initiate Registration",
			"item": [
				{
					"name": "Happy Path",
					"item": [
						{
							"name": "Initiate Registration - Success",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 201', function() {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"pm.test('Response has required fields', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.true;",
											"    pm.expect(jsonData.data.registration_id).to.exist;",
											"    pm.expect(jsonData.data.status).to.eql('PENDING_VERIFICATION');",
											"    pm.expect(jsonData.data.otp_config).to.exist;",
											"});",
											"",
											"if (pm.response.code === 201) {",
											"    var jsonData = pm.response.json();",
											"    pm.collectionVariables.set('registration_id', jsonData.data.registration_id);",
											"    pm.collectionVariables.set('registration_email', jsonData.data.email);",
											"    console.log('Saved registration_id:', jsonData.data.registration_id);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{test_email}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Initiates a new registration session and sends OTP to the provided email.\n\n**Expected:** 201 Created with registration_id and OTP config."
							},
							"response": [
								{
									"name": "201 - Registration Initiated",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"newuser@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Created",
									"code": 201,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": true,\n    \"data\": {\n        \"registration_id\": \"019462a1-7b3c-7def-8123-456789abcdef\",\n        \"email\": \"newuser@example.com\",\n        \"status\": \"PENDING_VERIFICATION\",\n        \"message\": \"Verification code sent to your email\",\n        \"expires_at\": \"2026-02-04T15:10:00Z\",\n        \"otp_config\": {\n            \"length\": 6,\n            \"expires_in_minutes\": 10,\n            \"max_attempts\": 5,\n            \"resend_cooldown_seconds\": 60,\n            \"max_resends\": 3\n        }\n    }\n}"
								}
							]
						}
					],
					"description": "Successful registration initiation scenarios"
				},
				{
					"name": "Validation Errors (400)",
					"item": [
						{
							"name": "Invalid Email Format",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is INVALID_EMAIL', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('INVALID_EMAIL');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"invalid-email-format\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Test with malformed email address.\n\n**Expected:** 400 Bad Request with INVALID_EMAIL error code."
							},
							"response": [
								{
									"name": "400 - Invalid Email Format",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"invalid-email-format\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_EMAIL\",\n        \"message\": \"Invalid email format\"\n    }\n}"
								}
							]
						},
						{
							"name": "Empty Email",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error indicates validation failure', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Test with empty email field.\n\n**Expected:** 400 Bad Request."
							},
							"response": [
								{
									"name": "400 - Empty Email",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_EMAIL\",\n        \"message\": \"Email is required\"\n    }\n}"
								}
							]
						},
						{
							"name": "Missing Email Field",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Test with missing email field entirely.\n\n**Expected:** 400 Bad Request."
							},
							"response": [
								{
									"name": "400 - Missing Email",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_EMAIL\",\n        \"message\": \"Email is required\"\n    }\n}"
								}
							]
						},
						{
							"name": "Email Too Long (>255 chars)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"verylongemailaddressthatexceedsthemaximumlengthallowedbythevalidationruleswhichissettotwohundredandfiftyfivecharactersandthisstringisdesignedtoexceedthatlimitbyaddingenoughcharacterstomakeitinvalidaccordingtotheschema@example.com\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Test with email exceeding 255 character limit.\n\n**Expected:** 400 Bad Request."
							},
							"response": [
								{
									"name": "400 - Email Too Long",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"verylongemailaddress...@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_EMAIL\",\n        \"message\": \"Email must not exceed 255 characters\"\n    }\n}"
								}
							]
						},
						{
							"name": "Invalid Tenant ID",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is INVALID_TENANT', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('INVALID_TENANT');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "00000000-0000-0000-0000-000000000000"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"user@example.com\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Test with non-existent tenant ID.\n\n**Expected:** 400 Bad Request with INVALID_TENANT error code."
							},
							"response": [
								{
									"name": "400 - Invalid Tenant",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "00000000-0000-0000-0000-000000000000"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_TENANT\",\n        \"message\": \"Tenant not found or inactive\"\n    }\n}"
								}
							]
						},
						{
							"name": "Missing X-Tenant-ID Header",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"user@example.com\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Test without X-Tenant-ID header.\n\n**Expected:** 400 Bad Request."
							},
							"response": [
								{
									"name": "400 - Missing Tenant Header",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_TENANT\",\n        \"message\": \"X-Tenant-ID header is required\"\n    }\n}"
								}
							]
						}
					],
					"description": "400 Bad Request scenarios for validation failures"
				},
				{
					"name": "Conflict Errors (409)",
					"item": [
						{
							"name": "Email Already Registered",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 409', function() {",
											"    pm.response.to.have.status(409);",
											"});",
											"",
											"pm.test('Error code is EMAIL_EXISTS', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('EMAIL_EXISTS');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{existing_user_email}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Test with email that is already registered in the system.\n\n**Expected:** 409 Conflict with EMAIL_EXISTS error code and suggestion to login."
							},
							"response": [
								{
									"name": "409 - Email Already Registered",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"existing@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Conflict",
									"code": 409,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"EMAIL_EXISTS\",\n        \"message\": \"This email is already registered\",\n        \"details\": {\n            \"suggestion\": \"Try logging in or use password reset\"\n        }\n    }\n}"
								}
							]
						},
						{
							"name": "Registration Already In Progress",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 409', function() {",
											"    pm.response.to.have.status(409);",
											"});",
											"",
											"pm.test('Error code is REGISTRATION_IN_PROGRESS', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('REGISTRATION_IN_PROGRESS');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Test initiating registration for an email that already has an active registration session in Redis.\n\n**Prerequisite:** Run 'Initiate Registration - Success' first.\n\n**Expected:** 409 Conflict with REGISTRATION_IN_PROGRESS error code."
							},
							"response": [
								{
									"name": "409 - Registration In Progress",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"pending@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Conflict",
									"code": 409,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"REGISTRATION_IN_PROGRESS\",\n        \"message\": \"Active registration exists for this email\"\n    }\n}"
								}
							]
						}
					],
					"description": "409 Conflict scenarios for duplicate registrations"
				},
				{
					"name": "Rate Limit Errors (429)",
					"item": [
						{
							"name": "Rate Limit Exceeded",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 429', function() {",
											"    pm.response.to.have.status(429);",
											"});",
											"",
											"pm.test('Error code is RATE_LIMIT_EXCEEDED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('RATE_LIMIT_EXCEEDED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"ratelimited@example.com\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations"]
								},
								"description": "Test when user has exceeded the rate limit (3 attempts per hour per email).\n\n**To test:** Call this endpoint 4+ times with the same email within an hour.\n\n**Expected:** 429 Too Many Requests with RATE_LIMIT_EXCEEDED error code."
							},
							"response": [
								{
									"name": "429 - Rate Limit Exceeded",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"ratelimited@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations"]
										}
									},
									"status": "Too Many Requests",
									"code": 429,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										},
										{
											"key": "Retry-After",
											"value": "3600"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"RATE_LIMIT_EXCEEDED\",\n        \"message\": \"Too many registration attempts. Please try again later.\"\n    }\n}"
								}
							]
						}
					],
					"description": "429 Too Many Requests scenarios for rate limiting"
				}
			],
			"description": "## POST /api/iam/v1/registrations\n\nInitiates a new registration session and sends OTP to the provided email.\n\n### Headers\n- `Content-Type: application/json`\n- `X-Tenant-ID: <tenant-uuid>` (required)\n\n### Request Body\n```json\n{\n    \"email\": \"user@example.com\"\n}\n```\n\n### Success Response (201)\nReturns registration_id and OTP configuration.\n\n### Error Responses\n- 400: INVALID_EMAIL, INVALID_TENANT\n- 409: EMAIL_EXISTS, REGISTRATION_IN_PROGRESS\n- 429: RATE_LIMIT_EXCEEDED"
		},
		{
			"name": "2. Verify OTP",
			"item": [
				{
					"name": "Happy Path",
					"item": [
						{
							"name": "Verify OTP - Success",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 200', function() {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Response has required fields', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.true;",
											"    pm.expect(jsonData.data.status).to.eql('VERIFIED');",
											"    pm.expect(jsonData.data.registration_token).to.exist;",
											"    pm.expect(jsonData.data.next_step).to.exist;",
											"});",
											"",
											"if (pm.response.code === 200) {",
											"    var jsonData = pm.response.json();",
											"    pm.collectionVariables.set('registration_token', jsonData.data.registration_token);",
											"    console.log('Saved registration_token');",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\",\n    \"otp_code\": \"{{otp_code}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
								},
								"description": "Verifies the OTP code sent to the user's email.\n\n**Prerequisite:** Run 'Initiate Registration - Success' first.\n\n**Expected:** 200 OK with registration_token and next_step instructions."
							},
							"response": [
								{
									"name": "200 - OTP Verified",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"123456\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": true,\n    \"data\": {\n        \"registration_id\": \"019462a1-7b3c-7def-8123-456789abcdef\",\n        \"status\": \"VERIFIED\",\n        \"message\": \"Email verified successfully\",\n        \"registration_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n        \"token_expires_at\": \"2026-02-04T15:25:00Z\",\n        \"next_step\": {\n            \"action\": \"complete_registration\",\n            \"endpoint\": \"/api/iam/v1/registrations/{id}/complete\",\n            \"required_fields\": [\"password\", \"password_confirmation\", \"first_name\", \"last_name\"]\n        }\n    }\n}"
								}
							]
						}
					],
					"description": "Successful OTP verification scenarios"
				},
				{
					"name": "Validation Errors (400)",
					"item": [
						{
							"name": "Invalid OTP Format - Not 6 Digits",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is INVALID_OTP_FORMAT', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('INVALID_OTP_FORMAT');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\",\n    \"otp_code\": \"12345\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
								},
								"description": "Test with OTP that is not exactly 6 digits.\n\n**Expected:** 400 Bad Request with INVALID_OTP_FORMAT error code."
							},
							"response": [
								{
									"name": "400 - Invalid OTP Format",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"12345\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_OTP_FORMAT\",\n        \"message\": \"OTP must be exactly 6 digits\"\n    }\n}"
								}
							]
						},
						{
							"name": "Invalid OTP Format - Non-Numeric",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is INVALID_OTP_FORMAT', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('INVALID_OTP_FORMAT');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\",\n    \"otp_code\": \"abc123\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
								},
								"description": "Test with OTP containing non-numeric characters.\n\n**Expected:** 400 Bad Request with INVALID_OTP_FORMAT error code."
							},
							"response": [
								{
									"name": "400 - Non-Numeric OTP",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"abc123\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_OTP_FORMAT\",\n        \"message\": \"OTP must contain only numeric digits\"\n    }\n}"
								}
							]
						},
						{
							"name": "Email Mismatch",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is EMAIL_MISMATCH', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('EMAIL_MISMATCH');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"different@example.com\",\n    \"otp_code\": \"123456\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
								},
								"description": "Test with email that doesn't match the registration email.\n\n**Expected:** 400 Bad Request with EMAIL_MISMATCH error code."
							},
							"response": [
								{
									"name": "400 - Email Mismatch",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"different@example.com\",\n    \"otp_code\": \"123456\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"EMAIL_MISMATCH\",\n        \"message\": \"Email does not match registration\"\n    }\n}"
								}
							]
						},
						{
							"name": "Missing OTP Code",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
								},
								"description": "Test with missing otp_code field.\n\n**Expected:** 400 Bad Request."
							},
							"response": [
								{
									"name": "400 - Missing OTP",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_OTP_FORMAT\",\n        \"message\": \"OTP code is required\"\n    }\n}"
								}
							]
						}
					],
					"description": "400 Bad Request scenarios for validation failures"
				},
				{
					"name": "Authentication Errors (401)",
					"item": [
						{
							"name": "Invalid OTP - Wrong Code",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 401', function() {",
											"    pm.response.to.have.status(401);",
											"});",
											"",
											"pm.test('Error code is INVALID_OTP', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('INVALID_OTP');",
											"});",
											"",
											"pm.test('Response includes attempts remaining', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.error.details.attempts_remaining).to.exist;",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\",\n    \"otp_code\": \"000000\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
								},
								"description": "Test with incorrect OTP code.\n\n**Expected:** 401 Unauthorized with INVALID_OTP error code and attempts_remaining count."
							},
							"response": [
								{
									"name": "401 - Invalid OTP",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"000000\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
										}
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_OTP\",\n        \"message\": \"The verification code is incorrect\",\n        \"details\": {\n            \"attempts_remaining\": 4\n        }\n    }\n}"
								}
							]
						}
					],
					"description": "401 Unauthorized scenarios for authentication failures"
				},
				{
					"name": "Not Found Errors (404)",
					"item": [
						{
							"name": "Registration Not Found",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 404', function() {",
											"    pm.response.to.have.status(404);",
											"});",
											"",
											"pm.test('Error code is REGISTRATION_NOT_FOUND', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('REGISTRATION_NOT_FOUND');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"123456\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/00000000-0000-0000-0000-000000000000/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "00000000-0000-0000-0000-000000000000", "verify-otp"]
								},
								"description": "Test with non-existent registration ID.\n\n**Expected:** 404 Not Found with REGISTRATION_NOT_FOUND error code."
							},
							"response": [
								{
									"name": "404 - Registration Not Found",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"123456\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/invalid-id/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "invalid-id", "verify-otp"]
										}
									},
									"status": "Not Found",
									"code": 404,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"REGISTRATION_NOT_FOUND\",\n        \"message\": \"Registration not found\"\n    }\n}"
								}
							]
						}
					],
					"description": "404 Not Found scenarios"
				},
				{
					"name": "Gone Errors (410)",
					"item": [
						{
							"name": "Registration Expired",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 410', function() {",
											"    pm.response.to.have.status(410);",
											"});",
											"",
											"pm.test('Error code is REGISTRATION_EXPIRED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('REGISTRATION_EXPIRED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\",\n    \"otp_code\": \"123456\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{expired_registration_id}}/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{expired_registration_id}}", "verify-otp"]
								},
								"description": "Test with expired registration session (TTL exceeded).\n\n**To test:** Wait 10+ minutes after initiating registration.\n\n**Expected:** 410 Gone with REGISTRATION_EXPIRED error code."
							},
							"response": [
								{
									"name": "410 - Registration Expired",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"123456\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
										}
									},
									"status": "Gone",
									"code": 410,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"REGISTRATION_EXPIRED\",\n        \"message\": \"Registration session has expired\"\n    }\n}"
								}
							]
						},
						{
							"name": "OTP Expired",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 410', function() {",
											"    pm.response.to.have.status(410);",
											"});",
											"",
											"pm.test('Error code is OTP_EXPIRED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('OTP_EXPIRED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\",\n    \"otp_code\": \"123456\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
								},
								"description": "Test with expired OTP (after 10 minutes).\n\n**To test:** Wait 10+ minutes after OTP was sent.\n\n**Expected:** 410 Gone with OTP_EXPIRED error code."
							},
							"response": [
								{
									"name": "410 - OTP Expired",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"123456\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
										}
									},
									"status": "Gone",
									"code": 410,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"OTP_EXPIRED\",\n        \"message\": \"OTP has expired, please request a new one\"\n    }\n}"
								}
							]
						}
					],
					"description": "410 Gone scenarios for expired resources"
				},
				{
					"name": "Rate Limit Errors (429)",
					"item": [
						{
							"name": "Max Attempts Exceeded",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 429', function() {",
											"    pm.response.to.have.status(429);",
											"});",
											"",
											"pm.test('Error code is MAX_ATTEMPTS_EXCEEDED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('MAX_ATTEMPTS_EXCEEDED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\",\n    \"otp_code\": \"000000\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
								},
								"description": "Test after exceeding maximum OTP verification attempts (5 attempts).\n\n**To test:** Send wrong OTP 5+ times.\n\n**Expected:** 429 Too Many Requests with MAX_ATTEMPTS_EXCEEDED error code. Registration is invalidated."
							},
							"response": [
								{
									"name": "429 - Max Attempts Exceeded",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"000000\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/verify-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "verify-otp"]
										}
									},
									"status": "Too Many Requests",
									"code": 429,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"MAX_ATTEMPTS_EXCEEDED\",\n        \"message\": \"Too many failed OTP attempts. Registration has been invalidated.\"\n    }\n}"
								}
							]
						}
					],
					"description": "429 Too Many Requests scenarios"
				}
			],
			"description": "## POST /api/iam/v1/registrations/{id}/verify-otp\n\nVerifies the OTP code sent to the user's email.\n\n### Headers\n- `Content-Type: application/json`\n- `X-Tenant-ID: <tenant-uuid>` (required)\n\n### Path Parameters\n- `id`: Registration ID from initiate response\n\n### Request Body\n```json\n{\n    \"email\": \"user@example.com\",\n    \"otp_code\": \"123456\"\n}\n```\n\n### Success Response (200)\nReturns registration_token for completing registration.\n\n### Error Responses\n- 400: INVALID_OTP_FORMAT, EMAIL_MISMATCH\n- 401: INVALID_OTP\n- 404: REGISTRATION_NOT_FOUND\n- 410: REGISTRATION_EXPIRED, OTP_EXPIRED\n- 429: MAX_ATTEMPTS_EXCEEDED"
		},
		{
			"name": "3. Resend OTP",
			"item": [
				{
					"name": "Happy Path",
					"item": [
						{
							"name": "Resend OTP - Success",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 200', function() {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Response has required fields', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.true;",
											"    pm.expect(jsonData.data.registration_id).to.exist;",
											"    pm.expect(jsonData.data.resends_remaining).to.exist;",
											"    pm.expect(jsonData.data.next_resend_available_at).to.exist;",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
								},
								"description": "Generates and sends a new OTP code. Previous OTP is invalidated.\n\n**Prerequisite:** Run 'Initiate Registration - Success' first, wait 60 seconds for cooldown.\n\n**Expected:** 200 OK with new expiration and resends_remaining count."
							},
							"response": [
								{
									"name": "200 - OTP Resent",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": true,\n    \"data\": {\n        \"registration_id\": \"019462a1-7b3c-7def-8123-456789abcdef\",\n        \"message\": \"New verification code sent to your email\",\n        \"expires_at\": \"2026-02-04T15:20:00Z\",\n        \"resends_remaining\": 2,\n        \"next_resend_available_at\": \"2026-02-04T15:11:00Z\"\n    }\n}"
								}
							]
						}
					],
					"description": "Successful OTP resend scenarios"
				},
				{
					"name": "Validation Errors (400)",
					"item": [
						{
							"name": "Email Mismatch",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is EMAIL_MISMATCH', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('EMAIL_MISMATCH');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"different@example.com\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
								},
								"description": "Test with email that doesn't match the registration.\n\n**Expected:** 400 Bad Request with EMAIL_MISMATCH error code."
							},
							"response": [
								{
									"name": "400 - Email Mismatch",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"different@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"EMAIL_MISMATCH\",\n        \"message\": \"Email does not match registration\"\n    }\n}"
								}
							]
						}
					],
					"description": "400 Bad Request scenarios"
				},
				{
					"name": "Not Found Errors (404)",
					"item": [
						{
							"name": "Registration Not Found",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 404', function() {",
											"    pm.response.to.have.status(404);",
											"});",
											"",
											"pm.test('Error code is REGISTRATION_NOT_FOUND', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('REGISTRATION_NOT_FOUND');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"user@example.com\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/00000000-0000-0000-0000-000000000000/resend-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "00000000-0000-0000-0000-000000000000", "resend-otp"]
								},
								"description": "Test with non-existent registration ID.\n\n**Expected:** 404 Not Found with REGISTRATION_NOT_FOUND error code."
							},
							"response": [
								{
									"name": "404 - Registration Not Found",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/invalid-id/resend-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "invalid-id", "resend-otp"]
										}
									},
									"status": "Not Found",
									"code": 404,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"REGISTRATION_NOT_FOUND\",\n        \"message\": \"Registration not found\"\n    }\n}"
								}
							]
						}
					],
					"description": "404 Not Found scenarios"
				},
				{
					"name": "Conflict Errors (409)",
					"item": [
						{
							"name": "Already Verified",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 409', function() {",
											"    pm.response.to.have.status(409);",
											"});",
											"",
											"pm.test('Error code is ALREADY_VERIFIED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('ALREADY_VERIFIED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
								},
								"description": "Test resending OTP after email is already verified.\n\n**Prerequisite:** Run 'Verify OTP - Success' first.\n\n**Expected:** 409 Conflict with ALREADY_VERIFIED error code."
							},
							"response": [
								{
									"name": "409 - Already Verified",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
										}
									},
									"status": "Conflict",
									"code": 409,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"ALREADY_VERIFIED\",\n        \"message\": \"Registration is already verified\"\n    }\n}"
								}
							]
						}
					],
					"description": "409 Conflict scenarios"
				},
				{
					"name": "Gone Errors (410)",
					"item": [
						{
							"name": "Registration Expired",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 410', function() {",
											"    pm.response.to.have.status(410);",
											"});",
											"",
											"pm.test('Error code is REGISTRATION_EXPIRED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('REGISTRATION_EXPIRED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{expired_registration_id}}/resend-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{expired_registration_id}}", "resend-otp"]
								},
								"description": "Test resending OTP for expired registration session.\n\n**Expected:** 410 Gone with REGISTRATION_EXPIRED error code."
							},
							"response": [
								{
									"name": "410 - Registration Expired",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
										}
									},
									"status": "Gone",
									"code": 410,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"REGISTRATION_EXPIRED\",\n        \"message\": \"Registration session has expired\"\n    }\n}"
								}
							]
						}
					],
					"description": "410 Gone scenarios"
				},
				{
					"name": "Rate Limit Errors (429)",
					"item": [
						{
							"name": "Resend Cooldown",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 429', function() {",
											"    pm.response.to.have.status(429);",
											"});",
											"",
											"pm.test('Error code is RESEND_COOLDOWN', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('RESEND_COOLDOWN');",
											"});",
											"",
											"pm.test('Response includes retry information', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.error.details.retry_after_seconds).to.exist;",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
								},
								"description": "Test resending OTP before cooldown period (60 seconds) has elapsed.\n\n**To test:** Call immediately after initiate or previous resend.\n\n**Expected:** 429 Too Many Requests with RESEND_COOLDOWN error code and retry_after_seconds."
							},
							"response": [
								{
									"name": "429 - Resend Cooldown",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
										}
									},
									"status": "Too Many Requests",
									"code": 429,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										},
										{
											"key": "Retry-After",
											"value": "45"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"RESEND_COOLDOWN\",\n        \"message\": \"Please wait before requesting another code\",\n        \"details\": {\n            \"retry_after_seconds\": 45,\n            \"retry_after\": \"2026-02-04T15:10:45Z\"\n        }\n    }\n}"
								}
							]
						},
						{
							"name": "Max Resends Exceeded",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 429', function() {",
											"    pm.response.to.have.status(429);",
											"});",
											"",
											"pm.test('Error code is MAX_RESENDS_EXCEEDED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('MAX_RESENDS_EXCEEDED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"{{registration_email}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
								},
								"description": "Test after exceeding maximum resend limit (3 resends per session).\n\n**To test:** Resend OTP 4+ times (with cooldown waits).\n\n**Expected:** 429 Too Many Requests with MAX_RESENDS_EXCEEDED error code."
							},
							"response": [
								{
									"name": "429 - Max Resends Exceeded",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/resend-otp",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "resend-otp"]
										}
									},
									"status": "Too Many Requests",
									"code": 429,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"MAX_RESENDS_EXCEEDED\",\n        \"message\": \"Maximum resend limit reached. Please start a new registration.\"\n    }\n}"
								}
							]
						}
					],
					"description": "429 Too Many Requests scenarios"
				}
			],
			"description": "## POST /api/iam/v1/registrations/{id}/resend-otp\n\nGenerates and sends a new OTP code. Previous OTP is invalidated.\n\n### Headers\n- `Content-Type: application/json`\n- `X-Tenant-ID: <tenant-uuid>` (required)\n\n### Path Parameters\n- `id`: Registration ID\n\n### Request Body\n```json\n{\n    \"email\": \"user@example.com\"\n}\n```\n\n### Success Response (200)\nReturns new expiration time and remaining resends.\n\n### Error Responses\n- 400: EMAIL_MISMATCH\n- 404: REGISTRATION_NOT_FOUND\n- 409: ALREADY_VERIFIED\n- 410: REGISTRATION_EXPIRED\n- 429: RESEND_COOLDOWN, MAX_RESENDS_EXCEEDED"
		},
		{
			"name": "4. Complete Registration",
			"item": [
				{
					"name": "Happy Path",
					"item": [
						{
							"name": "Complete Registration - Active User (Auto-Login)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 201', function() {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"pm.test('Response has required fields', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.true;",
											"    pm.expect(jsonData.data.user_id).to.exist;",
											"    pm.expect(jsonData.data.status).to.eql('ACTIVE');",
											"    pm.expect(jsonData.data.access_token).to.exist;",
											"    pm.expect(jsonData.data.refresh_token).to.exist;",
											"});",
											"",
											"if (pm.response.code === 201) {",
											"    var jsonData = pm.response.json();",
											"    pm.collectionVariables.set('user_id', jsonData.data.user_id);",
											"    if (jsonData.data.access_token) {",
											"        pm.collectionVariables.set('access_token', jsonData.data.access_token);",
											"        pm.collectionVariables.set('refresh_token', jsonData.data.refresh_token);",
											"    }",
											"    console.log('User created:', jsonData.data.user_id);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"phone_number\": \"+6281234567890\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Completes registration for a tenant that does NOT require approval.\n\n**Prerequisite:** Run 'Verify OTP - Success' first.\n\n**Expected:** 201 Created with user_id, ACTIVE status, and JWT tokens for auto-login."
							},
							"response": [
								{
									"name": "201 - Registration Complete (Active, Auto-Login)",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"phone_number\": \"+6281234567890\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Created",
									"code": 201,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": true,\n    \"data\": {\n        \"user_id\": \"019462a1-8888-7def-8123-456789abcdef\",\n        \"email\": \"user@example.com\",\n        \"status\": \"ACTIVE\",\n        \"message\": \"Registration completed successfully. You are now logged in.\",\n        \"profile\": {\n            \"first_name\": \"John\",\n            \"last_name\": \"Doe\"\n        },\n        \"access_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\",\n        \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n        \"token_type\": \"Bearer\",\n        \"expires_in\": 900\n    }\n}"
								}
							]
						},
						{
							"name": "Complete Registration - Pending Approval (No Tokens)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 201', function() {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"pm.test('Response has required fields', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.true;",
											"    pm.expect(jsonData.data.user_id).to.exist;",
											"    pm.expect(jsonData.data.status).to.eql('PENDING_APPROVAL');",
											"});",
											"",
											"pm.test('No tokens issued for pending approval', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.data.access_token).to.be.undefined;",
											"    pm.expect(jsonData.data.refresh_token).to.be.undefined;",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_with_approval_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Smith\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Completes registration for a tenant that REQUIRES admin approval.\n\n**Expected:** 201 Created with user_id, PENDING_APPROVAL status, and NO tokens."
							},
							"response": [
								{
									"name": "201 - Registration Complete (Pending Approval)",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_with_approval_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Smith\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Created",
									"code": 201,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": true,\n    \"data\": {\n        \"user_id\": \"019462a1-9999-7def-8123-456789abcdef\",\n        \"email\": \"user@example.com\",\n        \"status\": \"PENDING_APPROVAL\",\n        \"message\": \"Registration submitted. Your account is pending administrator approval. You will receive an email when your account is activated.\",\n        \"profile\": {\n            \"first_name\": \"Jane\",\n            \"last_name\": \"Smith\"\n        }\n    }\n}"
								}
							]
						},
						{
							"name": "Complete Registration - Without Phone (Optional)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 201', function() {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"pm.test('Response has required fields', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.true;",
											"    pm.expect(jsonData.data.user_id).to.exist;",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Completes registration without optional phone_number field.\n\n**Expected:** 201 Created - phone_number is optional."
							},
							"response": [
								{
									"name": "201 - Without Phone Number",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Created",
									"code": 201,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": true,\n    \"data\": {\n        \"user_id\": \"019462a1-8888-7def-8123-456789abcdef\",\n        \"email\": \"user@example.com\",\n        \"status\": \"ACTIVE\",\n        \"message\": \"Registration completed successfully. You are now logged in.\",\n        \"profile\": {\n            \"first_name\": \"John\",\n            \"last_name\": \"Doe\"\n        },\n        \"access_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\",\n        \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n        \"token_type\": \"Bearer\",\n        \"expires_in\": 900\n    }\n}"
								}
							]
						}
					],
					"description": "Successful registration completion scenarios"
				},
				{
					"name": "Validation Errors (400)",
					"item": [
						{
							"name": "Password Mismatch",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is PASSWORD_MISMATCH', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('PASSWORD_MISMATCH');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"DifferentP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Test with mismatched password and password_confirmation.\n\n**Expected:** 400 Bad Request with PASSWORD_MISMATCH error code."
							},
							"response": [
								{
									"name": "400 - Password Mismatch",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"DifferentP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"PASSWORD_MISMATCH\",\n        \"message\": \"Password and confirmation do not match\"\n    }\n}"
								}
							]
						},
						{
							"name": "Password Too Weak - Missing Uppercase",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is PASSWORD_TOO_WEAK', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('PASSWORD_TOO_WEAK');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"weakpassword123!\",\n    \"password_confirmation\": \"weakpassword123!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Test with password missing uppercase letter.\n\n**Expected:** 400 Bad Request with PASSWORD_TOO_WEAK error code and policy details."
							},
							"response": [
								{
									"name": "400 - Password Too Weak",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"weakpassword123!\",\n    \"password_confirmation\": \"weakpassword123!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"PASSWORD_TOO_WEAK\",\n        \"message\": \"Password does not meet security requirements\",\n        \"details\": {\n            \"policy\": {\n                \"min_length\": 8,\n                \"require_uppercase\": true,\n                \"require_lowercase\": true,\n                \"require_number\": true,\n                \"require_special\": true\n            },\n            \"violations\": [\n                \"Must contain at least one uppercase letter\"\n            ]\n        }\n    }\n}"
								}
							]
						},
						{
							"name": "Password Too Short",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is PASSWORD_TOO_WEAK', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('PASSWORD_TOO_WEAK');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"Short1!\",\n    \"password_confirmation\": \"Short1!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Test with password shorter than minimum length (8 characters).\n\n**Expected:** 400 Bad Request with PASSWORD_TOO_WEAK error code."
							},
							"response": [
								{
									"name": "400 - Password Too Short",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"Short1!\",\n    \"password_confirmation\": \"Short1!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"PASSWORD_TOO_WEAK\",\n        \"message\": \"Password does not meet security requirements\",\n        \"details\": {\n            \"violations\": [\n                \"Must be at least 8 characters long\"\n            ]\n        }\n    }\n}"
								}
							]
						},
						{
							"name": "Invalid Phone Format",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is INVALID_PHONE_FORMAT', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('INVALID_PHONE_FORMAT');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"phone_number\": \"invalid-phone\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Test with invalid phone number format (should be E.164).\n\n**Expected:** 400 Bad Request with INVALID_PHONE_FORMAT error code."
							},
							"response": [
								{
									"name": "400 - Invalid Phone Format",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"phone_number\": \"invalid-phone\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_PHONE_FORMAT\",\n        \"message\": \"Phone number must be in E.164 format (e.g., +6281234567890)\"\n    }\n}"
								}
							]
						},
						{
							"name": "Missing First Name",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Test with missing required first_name field.\n\n**Expected:** 400 Bad Request."
							},
							"response": [
								{
									"name": "400 - Missing First Name",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"VALIDATION_ERROR\",\n        \"message\": \"first_name is required\"\n    }\n}"
								}
							]
						}
					],
					"description": "400 Bad Request scenarios for validation failures"
				},
				{
					"name": "Authentication Errors (401)",
					"item": [
						{
							"name": "Invalid Registration Token",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 401', function() {",
											"    pm.response.to.have.status(401);",
											"});",
											"",
											"pm.test('Error code is INVALID_TOKEN', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('INVALID_TOKEN');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer invalid-token-here"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Test with invalid or malformed registration token.\n\n**Expected:** 401 Unauthorized with INVALID_TOKEN error code."
							},
							"response": [
								{
									"name": "401 - Invalid Token",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer invalid-token"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_TOKEN\",\n        \"message\": \"Registration token is invalid or expired\"\n    }\n}"
								}
							]
						},
						{
							"name": "Missing Authorization Header",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 401', function() {",
											"    pm.response.to.have.status(401);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Test without Authorization header.\n\n**Expected:** 401 Unauthorized."
							},
							"response": [
								{
									"name": "401 - Missing Authorization",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"INVALID_TOKEN\",\n        \"message\": \"Authorization header is required\"\n    }\n}"
								}
							]
						}
					],
					"description": "401 Unauthorized scenarios"
				},
				{
					"name": "Forbidden Errors (403)",
					"item": [
						{
							"name": "Not Verified Yet",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 403', function() {",
											"    pm.response.to.have.status(403);",
											"});",
											"",
											"pm.test('Error code is NOT_VERIFIED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('NOT_VERIFIED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{unverified_registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{unverified_registration_id}}", "complete"]
								},
								"description": "Test completing registration before OTP verification.\n\n**Expected:** 403 Forbidden with NOT_VERIFIED error code."
							},
							"response": [
								{
									"name": "403 - Not Verified",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Forbidden",
									"code": 403,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"NOT_VERIFIED\",\n        \"message\": \"Email has not been verified yet\"\n    }\n}"
								}
							]
						}
					],
					"description": "403 Forbidden scenarios"
				},
				{
					"name": "Not Found Errors (404)",
					"item": [
						{
							"name": "Registration Not Found",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 404', function() {",
											"    pm.response.to.have.status(404);",
											"});",
											"",
											"pm.test('Error code is REGISTRATION_NOT_FOUND', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('REGISTRATION_NOT_FOUND');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/00000000-0000-0000-0000-000000000000/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "00000000-0000-0000-0000-000000000000", "complete"]
								},
								"description": "Test with non-existent registration ID.\n\n**Expected:** 404 Not Found with REGISTRATION_NOT_FOUND error code."
							},
							"response": [
								{
									"name": "404 - Registration Not Found",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/invalid-id/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "invalid-id", "complete"]
										}
									},
									"status": "Not Found",
									"code": 404,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"REGISTRATION_NOT_FOUND\",\n        \"message\": \"Registration not found\"\n    }\n}"
								}
							]
						}
					],
					"description": "404 Not Found scenarios"
				},
				{
					"name": "Conflict Errors (409)",
					"item": [
						{
							"name": "Email Already Exists (Race Condition)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 409', function() {",
											"    pm.response.to.have.status(409);",
											"});",
											"",
											"pm.test('Error code is EMAIL_EXISTS', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('EMAIL_EXISTS');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
								},
								"description": "Edge case: email was registered by another process during this registration flow (race condition).\n\n**Expected:** 409 Conflict with EMAIL_EXISTS error code."
							},
							"response": [
								{
									"name": "409 - Email Exists (Race Condition)",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Conflict",
									"code": 409,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"EMAIL_EXISTS\",\n        \"message\": \"This email is already registered\"\n    }\n}"
								}
							]
						}
					],
					"description": "409 Conflict scenarios"
				},
				{
					"name": "Gone Errors (410)",
					"item": [
						{
							"name": "Registration Expired",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 410', function() {",
											"    pm.response.to.have.status(410);",
											"});",
											"",
											"pm.test('Error code is REGISTRATION_EXPIRED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.false;",
											"    pm.expect(jsonData.error.code).to.eql('REGISTRATION_EXPIRED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{registration_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{expired_registration_id}}/complete",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{expired_registration_id}}", "complete"]
								},
								"description": "Test completing an expired registration session.\n\n**Expected:** 410 Gone with REGISTRATION_EXPIRED error code."
							},
							"response": [
								{
									"name": "410 - Registration Expired",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{registration_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n}"
										},
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/complete",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "complete"]
										}
									},
									"status": "Gone",
									"code": 410,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"REGISTRATION_EXPIRED\",\n        \"message\": \"Registration session has expired\"\n    }\n}"
								}
							]
						}
					],
					"description": "410 Gone scenarios"
				}
			],
			"description": "## POST /api/iam/v1/registrations/{id}/complete\n\nSets the password and creates the user account.\n\n### Headers\n- `Content-Type: application/json`\n- `X-Tenant-ID: <tenant-uuid>` (required)\n- `Authorization: Bearer <registration_token>` (required)\n\n### Path Parameters\n- `id`: Registration ID\n\n### Request Body\n```json\n{\n    \"password\": \"SecureP@ssw0rd!\",\n    \"password_confirmation\": \"SecureP@ssw0rd!\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"phone_number\": \"+6281234567890\"\n}\n```\n\n### Success Response (201)\n- **ACTIVE status**: Returns user_id, profile, and JWT tokens (auto-login)\n- **PENDING_APPROVAL status**: Returns user_id and profile only (no tokens)\n\n### Error Responses\n- 400: PASSWORD_MISMATCH, PASSWORD_TOO_WEAK, INVALID_PHONE_FORMAT\n- 401: INVALID_TOKEN\n- 403: NOT_VERIFIED\n- 404: REGISTRATION_NOT_FOUND\n- 409: EMAIL_EXISTS\n- 410: REGISTRATION_EXPIRED"
		},
		{
			"name": "5. Check Registration Status",
			"item": [
				{
					"name": "Happy Path",
					"item": [
						{
							"name": "Get Status - Pending Verification",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 200', function() {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Response has required fields', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.success).to.be.true;",
											"    pm.expect(jsonData.data.registration_id).to.exist;",
											"    pm.expect(jsonData.data.status).to.exist;",
											"    pm.expect(jsonData.data.expires_at).to.exist;",
											"});",
											"",
											"pm.test('Email is masked', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.data.email).to.include('***');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/status?email={{registration_email}}",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "status"],
									"query": [
										{
											"key": "email",
											"value": "{{registration_email}}"
										}
									]
								},
								"description": "Check status of a registration in PENDING_VERIFICATION state.\n\n**Expected:** 200 OK with masked email, status, and remaining attempts/resends."
							},
							"response": [
								{
									"name": "200 - Pending Verification Status",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/status?email=user@example.com",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "status"],
											"query": [
												{
													"key": "email",
													"value": "user@example.com"
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": true,\n    \"data\": {\n        \"registration_id\": \"019462a1-7b3c-7def-8123-456789abcdef\",\n        \"email\": \"u***@example.com\",\n        \"status\": \"PENDING_VERIFICATION\",\n        \"expires_at\": \"2026-02-04T15:10:00Z\",\n        \"otp_attempts_remaining\": 5,\n        \"resends_remaining\": 3\n    }\n}"
								}
							]
						},
						{
							"name": "Get Status - Verified",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 200', function() {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Status is VERIFIED', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.data.status).to.eql('VERIFIED');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/status?email={{registration_email}}",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "status"],
									"query": [
										{
											"key": "email",
											"value": "{{registration_email}}"
										}
									]
								},
								"description": "Check status of a registration that has been verified.\n\n**Prerequisite:** Run 'Verify OTP - Success' first.\n\n**Expected:** 200 OK with status VERIFIED."
							},
							"response": [
								{
									"name": "200 - Verified Status",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/status?email=user@example.com",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "status"],
											"query": [
												{
													"key": "email",
													"value": "user@example.com"
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": true,\n    \"data\": {\n        \"registration_id\": \"019462a1-7b3c-7def-8123-456789abcdef\",\n        \"email\": \"u***@example.com\",\n        \"status\": \"VERIFIED\",\n        \"expires_at\": \"2026-02-04T15:25:00Z\",\n        \"otp_attempts_remaining\": 0,\n        \"resends_remaining\": 2\n    }\n}"
								}
							]
						}
					],
					"description": "Successful status check scenarios"
				},
				{
					"name": "Validation Errors (400)",
					"item": [
						{
							"name": "Missing Email Query Parameter",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/status",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "status"]
								},
								"description": "Test without required email query parameter.\n\n**Expected:** 400 Bad Request."
							},
							"response": [
								{
									"name": "400 - Missing Email",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/status",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "status"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"VALIDATION_ERROR\",\n        \"message\": \"email query parameter is required\"\n    }\n}"
								}
							]
						},
						{
							"name": "Email Mismatch",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 400', function() {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Error code is EMAIL_MISMATCH', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.error.code).to.eql('EMAIL_MISMATCH');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/status?email=wrong@example.com",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "status"],
									"query": [
										{
											"key": "email",
											"value": "wrong@example.com"
										}
									]
								},
								"description": "Test with email that doesn't match the registration.\n\n**Expected:** 400 Bad Request with EMAIL_MISMATCH error code."
							},
							"response": [
								{
									"name": "400 - Email Mismatch",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/{{registration_id}}/status?email=wrong@example.com",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "{{registration_id}}", "status"],
											"query": [
												{
													"key": "email",
													"value": "wrong@example.com"
												}
											]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"EMAIL_MISMATCH\",\n        \"message\": \"Email does not match registration\"\n    }\n}"
								}
							]
						}
					],
					"description": "400 Bad Request scenarios"
				},
				{
					"name": "Not Found Errors (404)",
					"item": [
						{
							"name": "Registration Not Found",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 404', function() {",
											"    pm.response.to.have.status(404);",
											"});",
											"",
											"pm.test('Error code is REGISTRATION_NOT_FOUND', function() {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.error.code).to.eql('REGISTRATION_NOT_FOUND');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-Tenant-ID",
										"value": "{{tenant_id}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/iam/v1/registrations/00000000-0000-0000-0000-000000000000/status?email=user@example.com",
									"host": ["{{base_url}}"],
									"path": ["api", "iam", "v1", "registrations", "00000000-0000-0000-0000-000000000000", "status"],
									"query": [
										{
											"key": "email",
											"value": "user@example.com"
										}
									]
								},
								"description": "Test with non-existent registration ID.\n\n**Expected:** 404 Not Found with REGISTRATION_NOT_FOUND error code."
							},
							"response": [
								{
									"name": "404 - Registration Not Found",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "X-Tenant-ID",
												"value": "{{tenant_id}}"
											}
										],
										"url": {
											"raw": "{{base_url}}/api/iam/v1/registrations/invalid-id/status?email=user@example.com",
											"host": ["{{base_url}}"],
											"path": ["api", "iam", "v1", "registrations", "invalid-id", "status"],
											"query": [
												{
													"key": "email",
													"value": "user@example.com"
												}
											]
										}
									},
									"status": "Not Found",
									"code": 404,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"body": "{\n    \"success\": false,\n    \"error\": {\n        \"code\": \"REGISTRATION_NOT_FOUND\",\n        \"message\": \"Registration not found\"\n    }\n}"
								}
							]
						}
					],
					"description": "404 Not Found scenarios"
				}
			],
			"description": "## GET /api/iam/v1/registrations/{id}/status\n\nReturns the current status of a registration session.\n\n### Headers\n- `X-Tenant-ID: <tenant-uuid>` (required)\n\n### Path Parameters\n- `id`: Registration ID\n\n### Query Parameters\n- `email`: Email to verify ownership (required)\n\n### Success Response (200)\nReturns masked email, status, expiration, and remaining attempts/resends.\n\n### Error Responses\n- 400: EMAIL_MISMATCH, VALIDATION_ERROR\n- 404: REGISTRATION_NOT_FOUND"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Generate unique test email if not set",
					"if (!pm.collectionVariables.get('test_email') || pm.collectionVariables.get('test_email').includes('{{')) {",
					"    var timestamp = Date.now();",
					"    var uniqueEmail = 'test.user.' + timestamp + '@example.com';",
					"    pm.collectionVariables.set('test_email', uniqueEmail);",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Log response time for performance monitoring",
					"console.log('Response time: ' + pm.response.responseTime + 'ms');"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080",
			"type": "string",
			"description": "Base URL for Dapen IAM Service"
		},
		{
			"key": "tenant_id",
			"value": "550e8400-e29b-41d4-a716-446655440000",
			"type": "string",
			"description": "Default tenant ID (no approval required)"
		},
		{
			"key": "tenant_with_approval_id",
			"value": "550e8400-e29b-41d4-a716-446655440001",
			"type": "string",
			"description": "Tenant ID that requires admin approval for new users"
		},
		{
			"key": "test_email",
			"value": "",
			"type": "string",
			"description": "Auto-generated unique email for testing"
		},
		{
			"key": "existing_user_email",
			"value": "existing@example.com",
			"type": "string",
			"description": "Email of an existing registered user"
		},
		{
			"key": "registration_id",
			"value": "",
			"type": "string",
			"description": "Current registration session ID (set by Initiate request)"
		},
		{
			"key": "registration_email",
			"value": "",
			"type": "string",
			"description": "Email used in current registration (set by Initiate request)"
		},
		{
			"key": "registration_token",
			"value": "",
			"type": "string",
			"description": "JWT token for completing registration (set by Verify OTP request)"
		},
		{
			"key": "otp_code",
			"value": "123456",
			"type": "string",
			"description": "OTP code for testing (use actual code from email in real tests)"
		},
		{
			"key": "expired_registration_id",
			"value": "",
			"type": "string",
			"description": "Registration ID that has expired (for testing expiration scenarios)"
		},
		{
			"key": "unverified_registration_id",
			"value": "",
			"type": "string",
			"description": "Registration ID that hasn't been verified (for testing NOT_VERIFIED error)"
		},
		{
			"key": "user_id",
			"value": "",
			"type": "string",
			"description": "Created user ID (set by Complete Registration request)"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string",
			"description": "JWT access token (set by Complete Registration for auto-login)"
		},
		{
			"key": "refresh_token",
			"value": "",
			"type": "string",
			"description": "JWT refresh token (set by Complete Registration for auto-login)"
		}
	]
}
